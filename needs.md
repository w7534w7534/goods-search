# 台股資訊查詢系統 — 需求規格

## 專案目標

個人看盤選股工具，以網頁形式呈現台灣股市的技術分析、籌碼面、基本面等完整資訊，
幫助自己快速掌握個股全貌並做出投資決策。

## 目標使用者

- 自己（個人使用），日常看盤、選股研究用

## 技術架構

- **前端**：HTML + CSS + JavaScript（ECharts 圖表庫）
- **後端**：Python Flask API 代理
- **資料來源**：
  - **主要**：FinMind API（收盤後完整資料，含技術面 / 籌碼面 / 基本面）
  - **輔助**：TWSE / TPEX Open Data（盤中即時報價，約 20 秒延遲）

---

## 功能需求 (FR)

### FR-1 搜尋與導航

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-1.1 | 股票搜尋 | 輸入股票名稱或代號模糊搜尋，下拉自動完成 | ✅ 已完成 |
| FR-1.2 | 熱門股票 | 首頁顯示常用股票快捷入口 | ✅ 已完成 |
| FR-1.3 | 自選股清單 | 可加入 / 移除自選股，localStorage 儲存 | ✅ 已完成 |
| FR-1.4 | 搜尋歷史 | 顯示最近查看的 5 支股票 | ❌ 待開發 |
| FR-1.5 | 動態熱門排行 | 依每日成交量動態排行取代固定清單 | ❌ 待開發 |

### FR-2 技術分析

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-2.1 | K 線圖 | 顯示開高低收 + 成交量，支援 1m/3m/6m/1y/2y/5y 區間 | ✅ 已完成 |
| FR-2.2 | 均線 (MA) | MA5 / MA10 / MA20 / MA60 / MA120，可切換顯示 | ✅ 已完成 |
| FR-2.3 | 布林通道 (BB) | 20日布林帶，含上/中/下軌 | ✅ 已完成 |
| FR-2.4 | VWAP | 量價加權均價 | ✅ 已完成 |
| FR-2.5 | RSI | 14日相對強弱指標 | ✅ 已完成 |
| FR-2.6 | MACD | 12/26/9 參數，含柱狀圖 | ✅ 已完成 |
| FR-2.7 | KD (隨機指標) | 9日 K/D 線 | ✅ 已完成 |
| FR-2.8 | OBV | 能量潮指標 | ✅ 已完成 |
| FR-2.9 | DMI / ADX | 趨向指標 + 平均趨向指數 | ✅ 已完成 |
| FR-2.10 | Williams %R | 14日威廉指標 | ✅ 已完成 |
| FR-2.11 | 乖離率 (BIAS) | 衡量股價偏離均線程度，判斷超買超賣 | ✅ 已完成 |
| FR-2.12 | ATR (真實波幅) | 量化波動風險，輔助停損停利設定 | ✅ 已完成 |
| FR-2.13 | PSY (心理線) | 判斷市場過度樂觀 / 悲觀 | ❌ 待開發 |
| FR-2.14 | SAR (拋物線) | 追蹤趨勢反轉點 | ❌ 待開發 |
| FR-2.15 | CCI (順勢指標) | 發現趨勢的起始與結束 | ❌ 待開發 |

### FR-3 籌碼面分析

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-3.1 | 三大法人買賣超 | 外資、投信、自營商每日買賣超金額 / 張數 | ✅ 已完成 |
| FR-3.2 | 大戶持股分佈 | 股權分散表（各級距持股比例） | ✅ 已完成 |
| FR-3.3 | 融資融券 | 融資餘額、融券餘額、融資使用率 | ✅ 已完成 |
| FR-3.4 | 券資比 | 融券 / 融資比率，判斷軋空風險 | ✅ 已完成 |
| FR-3.5 | 外資持股比例趨勢 | 外資持股張數與比例的趨勢變化圖 | ✅ 已完成 |
| FR-3.6 | 主力連續買賣超天數 | 標示法人連續買 / 賣超天數 | ✅ 已完成 |

### FR-4 基本面分析

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-4.1 | 歷年股利政策 | 現金 / 股票股利明細表 | ✅ 已完成 |
| FR-4.2 | 月營收趨勢 | 近 3 年月營收 + 年增率圖表 | ✅ 已完成 |
| FR-4.3 | 獲利能力 (EPS / 毛利率) | 季度 EPS 與毛利率趨勢圖 | ✅ 已完成 |
| FR-4.4 | 本益比 / 本淨比 / 殖利率 | 資訊卡片顯示最新值 | ✅ 已完成 |
| FR-4.5 | ROE / ROA | 股東權益報酬率、資產報酬率 | ✅ 已完成 |
| FR-4.6 | 自由現金流量 (FCF) | 營運現金流 — 資本支出 | ❌ 待開發 |
| FR-4.7 | 負債比率 | 總負債 / 總資產 | ✅ 已完成 |
| FR-4.8 | 配息率 + 填息天數 | 歷年配息率 & 除息後填息所需天數 | ✅ 已完成（配息率） |

### FR-5 估值 / 評價面（全新）

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-5.1 | P/E Band 河流圖 | 歷年本益比位置視覺化，判斷目前高低估 | ❌ 待開發 |
| FR-5.2 | P/B Band 河流圖 | 歷年本淨比位置視覺化 | ❌ 待開發 |
| FR-5.3 | 簡易 DDM 估值 | 依歷年股利折現估算合理股價 | ❌ 待開發 |

### FR-6 使用者體驗

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-6.1 | 明暗主題切換 | 深色 / 淺色主題，記住偏好 | ✅ 已完成 |
| FR-6.2 | CSV 匯出 | 匯出股價 / 法人 / 融資券資料 | ✅ 已完成 |
| FR-6.3 | 圖表截圖匯出 | K 線圖匯出為 PNG | ✅ 已完成 |
| FR-6.4 | 即時報價 | 盤中自動刷新股價（TWSE/TPEX Open Data） | ❌ 待開發 |
| FR-6.5 | 多股比較 | 2~4 支股票同頁比較 K 線 / 指標 / 基本面 | ❌ 待開發 |
| FR-6.6 | PWA 支援 | 手機可加到主畫面，離線基本瀏覽 | ❌ 待開發 |
| FR-6.7 | Excel 匯出 | 支援 .xlsx 格式匯出含技術指標 | ❌ 待開發 |

### FR-7 選股輔助

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-7.1 | 條件選股器 | 設定篩選條件一鍵篩出股票（例：RSI<30 且 MACD 黃金交叉 且 外資連買>3天 且 殖利率>5%） | ❌ 待開發 |
| FR-7.2 | 綜合評分卡 | 個股頁面自動給出技術面/籌碼面/基本面的簡易評分（如：技術 72/100） | ❌ 待開發 |
| FR-7.3 | 買賣訊號標記 | K 線圖上自動標出黃金交叉、死亡交叉、MACD 翻多/翻空、RSI 超買超賣等訊號 | ✅ 已完成 |

### FR-8 趨勢與風險分析

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-8.1 | 產業類股比較 | 同產業個股相對強弱比較（如：半導體族群近 3 月漲幅排名） | ❌ 待開發 |
| FR-8.2 | 大盤連動分析 | 個股與加權指數的 Beta 值、相關係數 | ❌ 待開發 |
| FR-8.3 | 回測模擬 | 選定技術指標策略（如：KD 黃金交叉買進），回測 1~3 年報酬率 | ❌ 待開發 |
| FR-8.4 | 風險指標 | 夏普比率 (Sharpe Ratio)、最大回撤 (Max Drawdown) | ❌ 待開發 |

### FR-9 通知提醒

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-9.1 | 價格警示 | 自選股到達設定價位時，瀏覽器推播通知 | ❌ 待開發 |
| FR-9.2 | 指標異常提醒 | 自選股 RSI 超買/超賣、法人連續大買等異常時自動提示 | ❌ 待開發 |
| FR-9.3 | MACD 高點死叉預警 | 偵測 MACD 柱狀體（DIF-MACD）連續縮短且 DIF 仍在零軸上方，推估即將死亡交叉，提前警示賣出時機 | ❌ 待開發 |

### FR-10 筆記與紀錄

| ID | 功能 | 說明 | 狀態 |
|:---|:---|:---|:---|
| FR-10.1 | 個股筆記 | 每支股票可加操作筆記（買入理由、觀察重點等），localStorage 儲存 | ❌ 待開發 |
| FR-10.2 | 操作紀錄 | 記錄買賣紀錄，自動計算損益與勝率 | ❌ 待開發 |

---

## 非功能需求 (NFR)

### NFR-1 效能

- API 快取：收盤資料 TTL 5 分鐘，股票清單每日更新
- 前端圖表載入須 < 3 秒（一般網路）
- 前端分批載入：優先渲染 K 線圖，其餘區塊非同步載入

### NFR-2 安全性

- API Token 透過 `.env` 管理，不得進入版控
- 後端加入 API 限流 (rate limiting) 防止濫用

### NFR-3 程式碼品質

- 統一 API 回傳格式：`{ "status": "ok|error", "data": ..., "message": "..." }`
- 前端共用邏輯抽為獨立模組，消除重複程式碼
- 後端使用 `logging` 模組替代 `print()`

### NFR-4 可維護性

- 使用 `uv` + `.venv` 管理 Python 套件環境
- 移除未使用的相依套件（如 `yfinance`）
- 前端 JS 重構為 ES Modules 架構

---

## 開發優先順序

### P0 — 基礎改善（最優先）
1. 抽取前端共用模組 `common.js`
2. 統一後端 API 錯誤回傳格式
3. `.env` + `python-dotenv` Token 管理
4. 移除未使用套件、導入 `logging`

### P1 — 功能增強
1. 新增技術指標：BIAS、ATR（優先）；PSY、SAR、CCI（次之）
2. 籌碼面：券資比、外資持股趨勢圖、主力連買天數
3. 基本面：ROE/ROA、FCF、負債比、配息率 + 填息天數
4. 估值河流圖 (P/E Band, P/B Band)
5. 買賣訊號標記（K 線圖上標出黃金交叉/死亡交叉/MACD 翻多等）
6. 個股筆記 + 操作紀錄

### P2 — 體驗升級
1. 即時報價（TWSE/TPEX API + 自動刷新）
2. 多股比較功能
3. PWA 支援
4. 搜尋歷史 + 動態熱門排行
5. Excel 匯出
6. 條件選股器 + 綜合評分卡
7. 產業類股比較 + 大盤連動分析
8. 回測模擬 + 風險指標 (Sharpe / Max Drawdown)
9. 價格警示 + 指標異常提醒