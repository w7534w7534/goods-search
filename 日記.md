# 台股資訊查詢系統 — 開發與修復日記

這本日記記錄了本專案從環境修復、介面優化到功能新增的完整歷程。

---

## 📅 2026-02-24：環境修復與初探
- **環境修復**：
  - 發現系統缺少 `flask`, `flask-cors`, `pandas`, `requests` 等核心套件。
  - 使用 `pip` 於 `.venv` 中完成安裝（由於環境未偵測到 `uv`，採傳統方式修復）。
  - 將伺服器 Port 從 `5000` 改為 `5001` 以避開 macOS 系統佔用。
- **籌碼面整合**：
  - 驗證「三大法人」、「融資融券」與「外資持股」API 正常運作。
  - 將舊有的外資持股獨立頁籤與圖表移除，轉向更易讀的表格化呈現。

## 📅 2026-02-25 (凌晨)：功能大改版與細節優化
- **基本面大幅度強化**：
  - 移除舊版股利政策，改為「單季每股盈餘 (EPS)」表格。
  - 加入「季增率%」與「年增率%」計算邏輯。
  - 將月營收圖表改為詳細資料表格，並加入「累計營收年增率」。
  - 實作「核心獲利能力評估矩陣」，自動偵測毛利或淨利警訊（Red Flags）。
- **股票新聞整合**：
  - **移除功能**：捨棄過時且不準確的「產業鏈關係分析」。
  - **新增功能**：串接 Yahoo Finance RSS 端點，實作 `/api/stock/news`。
  - **介面美化**：在個股頁面底部新增玻璃質感的新聞列表區塊。
- **除錯與深度診斷**：
  - **修正變數衝突**：解決整合新聞後導致基本面面板因變數命名衝突而無法顯示的問題。
  - **新聞卡死修復**：針對 Yahoo RSS 的特殊日期格式實作了 `try-catch` 解析與狀態補全邏輯。
  - **EPS 精確度與均價修正**：
    - 修正 FinMind 結算日與季度標籤偏移（解決 147 元 vs 167 元的誤差）。
    - **還原股價實作**：引入 `/api/stock/adjusted-factors` 接口，實作基礎還原偵測邏輯。
    - 調整 EPS 顯示位數至小數點第 1 位，完美對齊專業財報網站。

## 🚀 未來展望與部署規劃
- **網路部署**：已規劃 **PythonAnywhere** 或是 **Render** 的部署指引，讓使用者能 24 小時隨處使用。
- **數據持續精進**：持續關注還原股價計算的極端邊界情況（如大幅度減資）。

---
**日誌記錄者**：Antigravity (AI Pair Programmer)
**專案狀態**：功能穩定，精確度符合專業水準。
